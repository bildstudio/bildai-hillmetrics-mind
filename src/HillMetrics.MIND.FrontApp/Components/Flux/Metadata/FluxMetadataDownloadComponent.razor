@using HillMetrics.Core.Common
@using HillMetrics.MIND.API.Contracts.Requests.Flux
@using HillMetrics.Normalized.Domain.Contracts.Providing.Flux

<MudCard Elevation="0" Outlined="true" Class="mt-3">
    <MudCardHeader>
        <CardHeaderContent>
            <MudText Typo="Typo.h6">Download/Scraping Flux Configuration</MudText>
        </CardHeaderContent>
        <CardHeaderActions>
            <MudTooltip Text="Metadata for HTTP Download or Web Scraping">
                <MudIcon Icon="@Icons.Material.Filled.CloudDownload" Color="Color.Info" />
            </MudTooltip>
        </CardHeaderActions>
    </MudCardHeader>
    <MudCardContent>
        <MudGrid>
            <MudItem xs="12">
                <MudTextField @bind-Value="Metadata.DownloadUrl" 
                Label="URL" 
                Variant="Variant.Outlined"
                Required="true"
                Validation="@(new Func<string, IEnumerable<string>>(ValidateUrl))" />
            </MudItem>

            <MudItem xs="12">
                <MudTextField @bind-Value="Metadata.ContentType"
                Label="Content "
                Variant="Variant.Outlined"
                Required="true"
                Validation="@(new Func<string, IEnumerable<string>>(ValidateUrl))" />
            </MudItem>

            <MudSelect @bind-Value="Metadata.ContentType" Label="Content Type" Variant="Variant.Outlined" Required="true">
                <MudSelectItem Value="ContentType.Xlsx">Xlxs</MudSelectItem>
                <MudSelectItem Value="ContentType.Xls">Xlx</MudSelectItem>
                <MudSelectItem Value="ContentType.Csv">CSV</MudSelectItem>
                <MudSelectItem Value="ContentType.Json">Json</MudSelectItem>
                <MudSelectItem Value="ContentType.Pdf">Pdf</MudSelectItem>
                <MudSelectItem Value="ContentType.Html">Html</MudSelectItem>
                <MudSelectItem Value="ContentType.Text">Text</MudSelectItem>
                <MudSelectItem Value="ContentType.Xml">Xml</MudSelectItem>
            </MudSelect>
        </MudGrid>
    </MudCardContent>
</MudCard>

@code {
    [Parameter]
    public FluxMetadataDownloadRequestDto Metadata { get; set; } = new FluxMetadataDownloadRequestDto();

    [Parameter]
    public EventCallback<FluxMetadataDownloadRequestDto> MetadataChanged { get; set; }

    private IEnumerable<string> ValidateUrl(string url)
    {
        if (string.IsNullOrWhiteSpace(url))
            yield return "URL is required";
        else if (!url.StartsWith("http://") && !url.StartsWith("https://"))
            yield return "URL must start with http:// or https://";
    }

    protected override void OnParametersSet()
    {
        // Set default values if null
        Metadata ??= new FluxMetadataDownloadRequestDto();
    }
} 